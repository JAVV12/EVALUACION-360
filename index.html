<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Liderazgo 360 - Deploy a Vercel</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.39.0/build/stlite.css"
    />
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
      }
      #loader {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #001f3f;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: #d4af37;
        font-family: sans-serif;
        z-index: 9999;
      }
      .spinner {
        border: 4px solid rgba(212, 175, 55, 0.1);
        width: 36px;
        height: 36px;
        border-radius: 50%;
        border-left-color: #d4af37;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
    </style>
  </head>
  <body>
    <div id="loader">
      <div class="spinner"></div>
      <h2>Iniciando Liderazgo 360...</h2>
      <p>Configurando entorno Python en el navegador</p>
    </div>
    <div id="stlite"></div>
    <script src="https://cdn.jsdelivr.net/npm/@stlite/mountable@0.39.0/build/stlite.js"></script>
    <script>
      // Extraemos el código de app.py y otros módulos para inyectarlos en stlite
      // (En una implementación real, cargaríamos los archivos con fetch)
      
      const files = {
        "app.py": {
          url: "app.py"
        },
        "database.py": {
          url: "database.py"
        },
        "logic.py": {
          url: "logic.py"
        },
        "utils.py": {
          url: "utils.py"
        },
        "reports.py": {
          url: "reports.py"
        }
      };

      async function main() {
        const fileEntries = Object.entries(files);
        const fileContentMap = {};

        for (const [name, info] of fileEntries) {
          const response = await fetch(info.url);
          const content = await response.text();
          fileContentMap[name] = content;
        }

        stlite.mount({
          requirements: ["pandas", "plotly", "supabase", "reportlab", "openpyxl"],
          entrypoint: "app.py",
          files: fileContentMap,
          streamlitConfig: {
            "server.address": "localhost",
            "server.port": 8501,
            "theme.base": "light",
            "theme.primaryColor": "#d4af37",
            "theme.backgroundColor": "#fffcf2",
            "theme.secondaryBackgroundColor": "#001f3f",
            "theme.textColor": "#001f3f",
          }
        }, document.getElementById("stlite"));
        
        // Hide loader once stlite starts (this is approximate, stlite doesn't have a direct 'ready' callback in basic mount)
        setTimeout(() => {
          document.getElementById("loader").style.display = "none";
        }, 5000);
      }

      main();
    </script>
  </body>
</html>
